// Backbone.Binding v0.1.0
//
// Copyright (C) 2012 Ronald Fung
// Distributed Under MIT Liscene
//
// Documentation and Full Licence Availabe at:
// http://github.com/rycfung/backbone.binding
//
// ----------------------------
// Backbone.Binding
// ----------------------------
(function(a){var b=function(a,b,c){var d={version:"0.1.0",parseBinding:function(a,b){if(a[1].indexOf(".")>0)var c=a[1].match(/(.*)\.([^\.]*)$/),d=b.get(c[1].trim()),e=c[2].trim();return{bindingParam:d,bindingValue:e}},bind:function(a,b){var d=new g(a),e="model-bind",f=this;c("["+e+"]",b).each(function(a,b){var g=c(b).attr(e),h=g.split(":"),j=h[0].trim(),k=f.parseBinding(h,d);k.bindingValue.indexOf("()")>0?i[j].bindFunc(j,k.bindingValue,k.bindingParam,b):i[j].bindAttr(j,k.bindingValue,k.bindingParam,b)})}},e={_refreshSelect:function(a){c(a).selectmenu("refresh")},_refreshText:c.noop,_refreshCheckboxRadio:function(a){c(a).checkboxradio("refresh")},_refreshSlider:function(a){c(a).slider("refresh")},refresh:function(a){if(typeof c.mobile!="undefined"){var b,d=c(a).prop("tagName").toLowerCase();if(d=="select")c(a).attr("data-role")=="slider"?b="slider":b="select";else if(d=="input"){b=c(a).attr("type");if(typeof b=="undefined"||b==null)b="text"}switch(b){case"select":this._refreshSelect(a);break;case"text":this._refreshText(a);break;case"radio":case"checkbox":this._refreshCheckboxRadio(a);break;case"range":case"slider":this._refreshSlider(a);break;default:}}}},f=function(a){a.elementSetter&&b.isFunction(a.elementSetter)&&(this.setOnElement=a.elementSetter)};f.prototype={bindFunc:function(a,d,e,f){var g=d.substr(0,d.indexOf("()"));this.setOnElement(f,a,e[g].call(e)),e.on("change",b.bind(function(b){this.setOnElement(f,a,e[g].call(e))},this)),c(f).on("change",b.bind(function(a){e[g].call(e,c(a.target).val())},this))},bindAttr:function(a,d,e,f){this.setOnElement(f,a,e.get(d)),e.on("change:"+d,b.bind(function(b){this.setOnElement(f,a,e.get(d))},this)),c(f).on("change",function(a){var b={};b[d]=c(a.target).val(),e.set(b)})}};var g=function(d){this.params=d;if(c.isArray(this.params)||b.isObject(this.params))for(var e in this.params)if(!(this.params[e]instanceof a.Model)){var f=new g(this.params[e]);this.params[e]=f}};g.prototype={get:function(a){if(a.indexOf(".")>0){var b=a.match(/^([^\.]*)\.*(.*)/);return this.params[b[1]].get(b[2])}return this.params[a]},set:function(a){if(a.indexOf(".")>0){var b=a.match(/^([^\.]*)\.*(.*)/);return this.params[b[1]].set(b[2])}}};var h={select:function(a,b,d){d!=null&&typeof d!="undefined"?c('option[value="'+d+'"]',a).length>0?c('option[value="'+d+'"]',a).attr("selected","selected"):c(a).val(""):c(a).val(""),e.refresh(a)},text:function(a,b,d){typeof d!="undefined"&&c(a).text(d),e.refresh(a)},standard:function(a,b,d){typeof d!="undefined"?c(a).attr(b,d):c(a).attr(b)&&c(a).removeAttr(b),e.refresh(a)}},i={value:new f({elementSetter:h.standard}),select:new f({elementSetter:h.select}),text:new f({elementSetter:h.text})};return d};typeof define=="function"&&define.amd?define(["backbone","underscore","jquery"],function(a,c,d){return b(a,c,d)}):(a.Backbone=Backbone||{},a.Backbone.ModelBinding=b(Backbone,_,jQuery))})(this);