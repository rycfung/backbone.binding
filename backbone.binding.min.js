// Backbone.Binding v0.1.0
//
// Copyright (C) 2012 Ronald Fung
// Distributed Under MIT Liscene
//
// Documentation and Full Licence Availabe at:
// http://github.com/rycfung/backbone.binding
//
// ----------------------------
// Backbone.Binding
// ----------------------------
(function(a){"use strict";var b=function(a,b,c){var d=function(e){this.params=e;if(c.isArray(this.params)||b.isObject(this.params))for(var f in this.params)if(!(this.params[f]instanceof a.Model)){var g=new d(this.params[f]);this.params[f]=g}};d.prototype={get:function(a){if(a.indexOf(".")>0){var b=a.match(/^([^\.]*)\.*(.*)/);return this.params[b[1]].get(b[2])}return this.params[a]},set:function(a){if(a.indexOf(".")>0){var b=a.match(/^([^\.]*)\.*(.*)/);return this.params[b[1]].set(b[2])}}};var e={version:"0.1.0",parseBinding:function(a,b){if(a[1].indexOf(".")>0)var c=a[1].match(/(.*)\.([^\.]*)$/),d=b.get(c[1].trim()),e=c[2].trim();return{bindingParam:d,bindingValue:e}},bind:function(a,b){var e=new d(a),f="model-bind",g=this;c("["+f+"]",b).each(function(a,b){var d=c(b).attr(f),h=d.split(":"),j=h[0].trim(),k=g.parseBinding(h,e);k.bindingValue.indexOf("()")>0?i[j].bindFunc(j,k.bindingValue,k.bindingParam,b):i[j].bindAttr(j,k.bindingValue,k.bindingParam,b)})}},f={_refreshSelect:function(a){c(a).selectmenu("refresh")},_refreshText:c.noop,_refreshCheckboxRadio:function(a){c(a).checkboxradio("refresh")},_refreshSlider:function(a){c(a).slider("refresh")},refresh:function(a){if(typeof c.mobile!="undefined"){var b,d=c(a).attr("tagName").toLowerCase();if(d=="select")c(a).attr("data-role")=="slider"?b="slider":b="select";else if(d=="input"){b=c(a).attr("type");if(typeof b=="undefined"||b==null)b="text"}switch(b){case"select":this._refreshSelect(a);break;case"text":this._refreshText(a);break;case"radio":case"checkbox":this._refreshCheckboxRadio(a);break;case"range":case"slider":this._refreshSlider(a);break;default:}}}},g=function(a){a.elementSetter&&(this.setOnElement=a.elementSetter.set,this.getValOnElement=a.elementSetter.get||function(a,b){return c(a).val()}),this.bindFunc=b.bind(function(a,d,e,f){var g=d.substr(0,d.indexOf("()"));this.setOnElement(f,a,e[g].call(e)),e.on("change",b.bind(function(b){this.setOnElement(f,a,e[g].call(e))},this)),c(f).on("change",b.bind(function(a){e[g].call(e,this.getValOnElement(a.target))},this))},this),this.bindAttr=b.bind(function(a,d,e,f){this.setOnElement(f,a,e.get(d)),e.on("change:"+d,b.bind(function(b){this.setOnElement(f,a,e.get(d))},this)),c(f).on("change",b.bind(function(a){var b={};b[d]=this.getValOnElement(a.target),e.set(b)},this))},this)},h={select:{set:function(a,b,d){d!=null&&typeof d!="undefined"?c('option[value="'+d+'"]',a).length>0?c('option[value="'+d+'"]',a).attr("selected","selected"):c(a).val(""):c(a).val(""),f.refresh(a)}},text:{set:function(a,b,d){typeof d!="undefined"&&c(a).text(d),f.refresh(a)}},checkbox:{set:function(a,b,d){typeof d!="undefined"?d?c(a).attr("checked",!0):c(a).attr("checked, false"):c(a).attr("checked",!1)},get:function(a){return c(a).is(":checked")}},standard:{set:function(a,b,d){typeof d!="undefined"?c(a).attr(b,d):c(a).attr(b)&&c(a).removeAttr(b),f.refresh(a)}}},i={value:new g({elementSetter:h.standard}),select:new g({elementSetter:h.select}),text:new g({elementSetter:h.text}),checkbox:new g({elementSetter:h.checkbox})};return e};typeof define=="function"&&define.amd?define(["backbone","underscore","jquery"],function(a,c,d){return b(a,c,d)}):(a.Backbone=Backbone||{},a.Backbone.ModelBinding=b(Backbone,_,jQuery))})(this);